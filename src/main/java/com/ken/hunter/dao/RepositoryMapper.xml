<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ken.hunter.dao.RepositoryMapper">
	
	<resultMap type="com.ken.hunter.domain.Repository" id="repository">
		<id property="id" column="REPO_ID"/>
		<result property="address" column="REPO_ADDRESS"/>
		<result property="status" column="REPO_STATUS"/>
		<result property="area" column="REPO_AREA"/>
		<result property="desc" column="REPO_DESC"/>
		<result property="adminName" column="REPO_ADMIN_NAME"/>
	</resultMap>

	<select id="selectAll" resultMap="repository">
		select
			r.REPO_ID,
			r.REPO_ADDRESS,
			r.REPO_STATUS,
			r.REPO_AREA,
			r.REPO_DESC,
			ra.REPO_ADMIN_NAME
		from
			hunter_respository r left join hunter_repo_admin ra on(r.REPO_ID = ra.REPO_ADMIN_REPOID)
	</select>
	
	<select id="selectUnassign" resultMap="repository">
		select
			r.REPO_ID,
			r.REPO_ADDRESS,
			r.REPO_STATUS,
			r.REPO_AREA,
			r.REPO_DESC
		from
			hunter_respository r
		where not exists
		(
			select *
			from
				hunter_repo_admin ra
			where
				ra.REPO_ADMIN_REPOID = r.REPO_ID
		)
	</select>
	
	<select id="selectByID" resultMap="repository">
		select
			r.REPO_ID,
			r.REPO_ADDRESS,
			r.REPO_STATUS,
			r.REPO_AREA,
			r.REPO_DESC,
			ra.REPO_ADMIN_NAME
		from
			hunter_respository r left join hunter_repo_admin ra on(r.REPO_ID = ra.REPO_ADMIN_REPOID)
		where
			r.REPO_ID = #{repositoryID}
	</select>
	
	<select id="selectByAddress" resultMap="repository">
		select
			r.REPO_ID,
			r.REPO_ADDRESS,
			r.REPO_STATUS,
			r.REPO_AREA,
			r.REPO_DESC,
			ra.REPO_ADMIN_NAME
		from
			hunter_respository r left join hunter_repo_admin ra on(r.REPO_ID = ra.REPO_ADMIN_REPOID)
		where
			r.REPO_ADDRESS like concat(concat("%",#{address},"%"))
	</select>
	
	<insert id="insert" keyProperty="id" useGeneratedKeys="true">
		insert into hunter_respository(REPO_ADDRESS,REPO_STATUS,REPO_AREA,REPO_DESC)
		values(#{address},#{status},#{area},#{desc})
	</insert>
	
	<insert id="insertbatch">
		insert into hunter_respository(REPO_ADDRESS,REPO_STATUS,REPO_AREA,REPO_DESC)
		values
		<foreach collection="list" item="repository" separator=",">
			(#{repository.address},#{repository.status},#{repository.area},#{repository.desc})
		</foreach>
	</insert>
	
	<update id="update">
		update
			hunter_respository
		set
			REPO_ADDRESS = #{address},
			REPO_STATUS = #{status},
			REPO_AREA = #{area},
			REPO_desc = #{desc}
		where
			REPO_ID = #{id}
	</update>
	
	<delete id="deleteByID">
		delete from hunter_respository
		where REPO_ID = #{id}
	</delete>
</mapper>